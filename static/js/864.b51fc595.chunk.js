"use strict";(self.webpackChunkmusicovery_front=self.webpackChunkmusicovery_front||[]).push([[864],{486:(t,a,s)=>{s.d(a,{A:()=>c});var e=s(5043),l=s(4935),i=s(6375),n=s(579);const c=t=>{let{onSelectTrack:a}=t;const{keyword:s,setKeyword:c,results:r,handleSearch:o,isPremium:d}=(0,i.A)(),[p,m]=(0,e.useState)(!1);return(0,n.jsxs)("div",{className:"music-search",children:[d,(0,n.jsxs)("form",{onSubmit:t=>{t.preventDefault(),o(),m(!0)},children:[" ",(0,n.jsx)("input",{className:"music-search-input",type:"text",value:s,onChange:t=>c(t.target.value),placeholder:"\uc74c\uc545 \uac80\uc0c9"}),(0,n.jsx)("button",{type:"submit",children:"\ud83d\udd0e"})]}),(0,n.jsx)("div",{className:"music-search-results",children:p||0!==r.length?r.map(((t,s)=>(0,n.jsx)("div",{onClick:()=>a(t),children:(0,n.jsx)(l.A,{track:t,isPremium:d})},t.id))):(0,n.jsx)("div",{className:"music-search-placeholder",children:"\uac80\uc0c9\uc5b4 \uc785\ub825..."})})]})}},4935:(t,a,s)=>{s.d(a,{A:()=>m});var e=s(5043),l=s(7950),i=s(5026),n=s(4003),c=s(7138),r=s(9428),o=s(579);const d=e.memo((t=>{let{playlist:a,isChecked:s,onCheck:e}=t;return(0,o.jsxs)("div",{className:"playlist-modal-item",children:[(0,o.jsx)("input",{type:"checkbox",id:`playlist-${a.playlistId}`,checked:s,onChange:()=>e(a.playlistId)}),(0,o.jsxs)("label",{htmlFor:`playlist-${a.playlistId}`,className:"playlist-modal-label",children:[(0,o.jsx)("div",{className:"playlist-modal-image-container",children:(0,o.jsx)("img",{src:(0,c.V)(a.playlistPhoto),alt:a.playlistTitle,className:"playlist-modal-image"})}),(0,o.jsx)("span",{className:"playlist-modal-name",children:a.playlistTitle})]})]})})),p=e.memo((t=>{let{playlists:a,selectedPlaylists:s,loading:e,onCheck:l,onClose:i,onAdd:n}=t;return(0,o.jsx)("div",{className:"playlist-modal-overlay",onClick:i,children:(0,o.jsxs)("div",{className:"playlist-modal",onClick:t=>t.stopPropagation(),children:[(0,o.jsxs)("div",{className:"playlist-modal-header",children:[(0,o.jsx)("h3",{children:"\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uc5d0 \ucd94\uac00"}),(0,o.jsx)("button",{className:"playlist-modal-close",onClick:i,children:"\xd7"})]}),(0,o.jsx)("div",{className:"playlist-modal-body",children:e?(0,o.jsx)("p",{children:"\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\ub97c \ubd88\ub7ec\uc624\ub294 \uc911..."}):0===a.length?(0,o.jsx)("p",{children:"\uc0ac\uc6a9 \uac00\ub2a5\ud55c \ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):(0,o.jsx)("div",{className:"playlist-modal-list",children:a.map((t=>(0,o.jsx)(d,{playlist:t,isChecked:s.includes(t.playlistId),onCheck:l},t.playlistId)))})}),(0,o.jsx)("div",{className:"playlist-modal-footer",children:(0,o.jsx)("button",{className:"add-to-playlist-button",onClick:n,disabled:0===s.length||e,children:"\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uc5d0 \ucd94\uac00"})})]})})})),m=t=>{let{track:a,isPremium:s}=t;const[c,d]=(0,e.useState)({}),[m,y]=(0,e.useState)(!1),[u,h]=(0,e.useState)([]),[x,j]=(0,e.useState)([]),[g,k]=(0,e.useState)(!1),{addTrackToList:v,setIsPlaying:C,deviceReady:N}=(0,e.useContext)(r.vC),f=(0,e.useRef)(!1),b=(0,n.A)(),P=()=>{y(!1),j([])},A=(0,e.useCallback)((t=>{j((a=>a.includes(t)?a.filter((a=>a!==t)):[...a,t]))}),[]);return a&&a.album&&a.album.images&&a.album.images[0]?(0,o.jsxs)("div",{className:"track-item",onMouseEnter:t=>{const a=t.currentTarget.getBoundingClientRect();d({top:a.top-10+"px",left:`${a.left+a.width/2}px`})},onMouseLeave:()=>{d({})},children:[(0,o.jsx)("img",{className:"track-album-image-music",src:a.album.images[0].url,alt:a.name}),(0,o.jsxs)("div",{className:"track-info",children:[(0,o.jsx)("h4",{children:a.name}),(0,o.jsx)("p",{children:a.artists.map((t=>t.name)).join(", ")}),(0,o.jsxs)("div",{className:"tooltip",style:c,children:[(0,o.jsx)("h4",{children:a.name}),(0,o.jsx)("p",{children:a.artists.map((t=>t.name)).join(", ")})]})]}),(0,o.jsxs)("div",{className:"track-play-button-container",children:[(0,o.jsx)("button",{onClick:()=>(async t=>{if(s)try{v(t),N?C(!0):N||setTimeout((()=>{C(!0)}),1e3)}catch(l){var a,e;if(console.error("\ud2b8\ub799 \uc7ac\uc0dd \uc911 \uc624\ub958:",l),403===(null===(a=l.response)||void 0===a?void 0:a.status))return void window.open(t.external_urls.spotify,"_blank");404===(null===(e=l.response)||void 0===e?void 0:e.status)?alert("Spotify \ud50c\ub808\uc774\uc5b4\ub97c \ucd08\uae30\ud654 \uc911\uc785\ub2c8\ub2e4. \uc7a0\uc2dc \ud6c4\uc5d0 \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."):alert("\ud2b8\ub799\uc744 \uc7ac\uc0dd\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.")}else window.open(t.external_urls.spotify,"_blank")})(a),className:s?"premium-play":"spotify-link",children:s?"\u25b6":"LINK"}),(0,o.jsx)("button",{className:"add-track-to-playlist-button",onClick:()=>{y(!0),b&&!f.current&&(async t=>{if(t&&!f.current){k(!0);try{const a=await i.A.get(`/playlist/user/${t}`);h(a.data||[]),f.current=!0}catch(a){console.error("\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\ub97c \ubd88\ub7ec\uc624\ub294 \ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4:",a)}finally{k(!1)}}})(b.userId)},children:"\u2795"})]}),m&&l.createPortal((0,o.jsx)(p,{playlists:u,selectedPlaylists:x,loading:g,onCheck:A,onClose:P,onAdd:async()=>{if(0!==x.length)try{const t=x.map((t=>i.A.post(`/api/spotify/playlist/${t}/track`,null,{params:{trackId:a.id}})));await Promise.all(t),alert("\uc120\ud0dd\ud55c \ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uc5d0 \ud2b8\ub799\uc774 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),P()}catch(t){console.error("\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uc5d0 \ud2b8\ub799 \ucd94\uac00 \uc2e4\ud328:",t),alert("\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\uc5d0 \ud2b8\ub799 \ucd94\uac00 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}else alert("\ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694.")}}),document.body)]},a.id):null}},5928:(t,a,s)=>{s.d(a,{C:()=>e});const e=t=>("string"===typeof t?JSON.parse(t):t).items.map((t=>({id:t.track.id,...t.track})))},6375:(t,a,s)=>{s.d(a,{A:()=>n});var e=s(5043),l=s(5026),i=s(6213);const n=()=>{const[t,a]=(0,e.useState)(""),[s,n]=(0,e.useState)([]),[c,r]=(0,e.useState)(new Audio),[o,d]=(0,e.useState)(!1),[p,m]=(0,e.useState)(null);(0,e.useEffect)((()=>{(async()=>{try{const t=await l.A.get("/api/spotify/userInfo");d("premium"===t.data.product)}catch(t){}})()}),[]),(0,e.useEffect)((()=>{(async()=>{try{const t=(await l.A.get("/music/devices",{headers:{Authorization:`Bearer ${localStorage.getItem("MUSICOVERY_ACCESS_TOKEN")}`}})).data.devices;t.length>0&&(m(t[0].id),await(async t=>{try{const a="https://api.spotify.com/v1/me/player";await i.A.put(a,{device_ids:[t],play:!0},{headers:{Authorization:`Bearer ${localStorage.getItem("MUSICOVERY_ACCESS_TOKEN")}`}})}catch(a){throw console.error("Failed to transfer playback:",a),a}})(t[0].id))}catch(t){console.error("Failed to fetch devices",t)}})()}),[]);return{keyword:t,setKeyword:a,results:s,handleSearch:async a=>{try{const a=(await l.A.get(`/api/spotify/search?keyword=${t}&type=track`)).data.tracks.items.filter((t=>t.is_playable));n(a)}catch(s){console.error("Failed to search music",s),n([])}},isPremium:o,deviceId:p}}},7138:(t,a,s)=>{s.d(a,{N:()=>i,V:()=>l});const e="http://211.243.7.215:8080/images/default.png",l=t=>t?t.startsWith("/images/")?`http://211.243.7.215:8080${t}`:t:e,i=()=>e},8574:(t,a,s)=>{s.d(a,{A:()=>i});s(5043);var e=s(1675),l=s(579);const i=t=>{let{text:a,link:s,color:i,onClick:n=()=>{}}=t;return(0,l.jsx)(e.N_,{to:s,className:"button "+(i?"custom-color":""),onClick:n,children:a})}},8864:(t,a,s)=>{s.r(a),s.d(a,{default:()=>x});var e=s(5043),l=s(1675),i=s(5026),n=s(4935),c=s(486),r=s(6375),o=s(4003),d=s(8574),p=s(5928),m=s(7138),y=s(9428),u=s(5422),h=s(579);const x=()=>{var t;const{playlistId:a}=(0,l.g)(),s=(0,l.Zp)(),x=(0,o.A)(),{handlePlay:j,isPremium:g}=(0,r.A)(),k=!!(null===(t=(0,l.zy)().state)||void 0===t?void 0:t.friendInfo),{addTracksToList:v,setIsPlaying:C,deviceReady:N}=(0,e.useContext)(y.vC),[f,b]=(0,e.useState)({playlistTitle:"",playlistComment:"",playlistPhoto:null,playlistDate:"",tracksData:[],isEditing:!1,user:x});(0,e.useEffect)((()=>{(async()=>{try{const t=await i.A.get(`/playlist/detail/${a}`),s=(0,p.C)(t.data.tracks);b((a=>({...a,playlistTitle:t.data.playlist.playlistTitle,playlistComment:t.data.playlist.playlistComment,playlistPhoto:(0,m.V)(t.data.playlist.playlistPhoto),playlistDate:t.data.playlist.playlistDate.substring(0,10),isPublic:t.data.playlist.isPublic,tracksData:s})))}catch(t){console.error("Error fetching playlist detail",t)}})()}),[a]),(0,e.useEffect)((()=>{x&&b((t=>({...t,user:x})))}),[x]);return(0,h.jsxs)("div",{className:"container1",children:[(0,h.jsx)(u.A,{}),(0,h.jsxs)("div",{className:"playlist-detail-container",children:[(0,h.jsx)("div",{className:"playlist-detail-header",children:f.isEditing?(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("input",{className:"playlist-detail-title-input",value:f.playlistTitle,onChange:t=>b((a=>({...a,playlistTitle:t.target.value})))})}):(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("h2",{className:"playlist-detail-title",children:f.playlistTitle})})}),(0,h.jsxs)("div",{className:"playlist-detail-body",children:[(0,h.jsxs)("div",{className:"playlist-detail-left",children:[(0,h.jsx)("img",{src:f.playlistPhoto,alt:"Playlist",className:"playlist-detail-photo"}),f.isEditing&&(0,h.jsx)("input",{type:"file",onChange:t=>{b((a=>({...a,playlistPhoto:t.target.files[0]})))},accept:"image/*"}),(0,h.jsxs)("div",{className:"playlist-tracks-container",children:[f.isEditing&&(0,h.jsx)("div",{className:"music-search-container",children:(0,h.jsx)(c.A,{onSelectTrack:t=>{b((a=>({...a,tracksData:[...a.tracksData,t]})))}})}),(0,h.jsx)("div",{className:"playlist-tracks "+(f.isEditing?"playlist-tracks-editing":""),children:f.tracksData.length>0?f.tracksData.map(((t,s)=>{const e=`${a}-${s}`;return(0,h.jsxs)("div",{className:"list-track-item",children:[(0,h.jsx)(n.A,{track:t,handlePlay:j,isPremium:g}),f.isEditing&&(0,h.jsx)("button",{className:"playlist-update-track-remove-button",onClick:()=>{return a=t.id,void b((t=>({...t,tracksData:t.tracksData.filter((t=>t.id!==a))})));var a},children:"\u274c"})]},e)})):(0,h.jsx)("p",{children:"\ub178\ub798\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})]})]}),(0,h.jsxs)("div",{className:"playlist-detail-right",children:[g&&(0,h.jsx)("div",{className:"playlist-play-controls",children:(0,h.jsx)("button",{className:"playlist-play-all-button",onClick:()=>{0!==f.tracksData.length?(v(f.tracksData),N?C(!0):setTimeout((()=>{C(!0)}),1e3)):alert("\uc7ac\uc0dd\ud560 \ud2b8\ub799\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.")},disabled:0===f.tracksData.length,children:"\u25b6"})}),f.isEditing?(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("textarea",{className:"playlist-detail-playlistComment-input",value:f.playlistComment,onChange:t=>b((a=>({...a,playlistComment:t.target.value})))})}):(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("p",{className:"playlist-detail-playlistComment",children:f.playlistComment})}),(0,h.jsx)("p",{children:f.playlistDate}),(0,h.jsxs)("div",{className:"editing-button-area",children:[k?null:(0,h.jsx)(h.Fragment,{children:f.isEditing?(0,h.jsx)(d.A,{text:"\uc800\uc7a5",onClick:async()=>{const t=new FormData;t.append("playlistId",a),t.append("playlistTitle",f.playlistTitle),t.append("playlistComment",f.playlistComment),t.append("playlistDate",f.playlistDate),t.append("isPublic",f.isPublic),t.append("userId",f.user.userId),f.playlistPhoto&&"string"!==typeof f.playlistPhoto?t.append("playlistPhoto",f.playlistPhoto):t.append("existingPlaylistPhoto",f.playlistPhoto||""),t.append("tracks",f.tracksData.map((t=>t.uri)));try{await i.A.post("/playlist/update",t,{headers:{"Content-Type":"multipart/form-data"}}),b((t=>({...t,isEditing:!1}))),s("/PlaylistPage")}catch(e){console.error("Error updating playlist",e)}}}):(0,h.jsx)(d.A,{text:"\uc218\uc815",onClick:()=>{b((t=>({...t,isEditing:!0})))}})}),(0,h.jsx)(d.A,{text:"\ub4a4\ub85c\uac00\uae30",onClick:()=>{s(-1)}})]})]})]})]})]})}}}]);
//# sourceMappingURL=864.b51fc595.chunk.js.map